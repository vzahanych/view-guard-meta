syntax = "proto3";

package edge.control;

option go_package = "github.com/vzahanych/view-guard-meta/proto/go/generated/edge";

// ControlService handles control commands from KVM VM to Edge
service ControlService {
  // GetConfig retrieves current Edge configuration
  rpc GetConfig(GetConfigRequest) returns (GetConfigResponse);
  
  // UpdateConfig updates Edge configuration
  rpc UpdateConfig(UpdateConfigRequest) returns (UpdateConfigResponse);
  
  // RestartService restarts a specific service
  rpc RestartService(RestartServiceRequest) returns (RestartServiceResponse);

  // SyncCapabilities allows an Edge to report camera and dataset readiness
  rpc SyncCapabilities(SyncCapabilitiesRequest) returns (SyncCapabilitiesResponse);
}

// GetConfigRequest requests current configuration
message GetConfigRequest {
  // Empty for now, can be extended with filter options
}

// GetConfigResponse contains current configuration
message GetConfigResponse {
  bool success = 1;
  string config_json = 2; // JSON-encoded configuration
  string error_message = 3;
}

// UpdateConfigRequest contains configuration updates
message UpdateConfigRequest {
  string config_json = 1; // JSON-encoded configuration updates
}

// UpdateConfigResponse contains update result
message UpdateConfigResponse {
  bool success = 1;
  string error_message = 2;
}

// RestartServiceRequest requests service restart
message RestartServiceRequest {
  string service_name = 1; // Service name to restart
}

// RestartServiceResponse contains restart result
message RestartServiceResponse {
  bool success = 1;
  string error_message = 2;
}

// SyncCapabilitiesRequest contains camera/dataset readiness information
message SyncCapabilitiesRequest {
  repeated CameraCapability cameras = 1;
  int64 synced_at = 2; // Unix nano timestamp when snapshot was taken
}

// CameraCapability describes a single camera's dataset readiness state
message CameraCapability {
  string camera_id = 1;
  string name = 2;
  string type = 3;
  bool enabled = 4;
  string status = 5;
  uint32 labeled_snapshot_count = 6;
  uint32 required_snapshot_count = 7;
  bool snapshot_required = 8;
  map<string, uint32> label_counts = 9;
}

// SyncCapabilitiesResponse contains the result of syncing capabilities
message SyncCapabilitiesResponse {
  bool success = 1;
  string error_message = 2;
}

